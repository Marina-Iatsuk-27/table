<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        .table-wrapper {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            height: 90vh;
            width: 90vw;
        }

        img {
            height: 150px;
        }

        .bi-filter {
            margin-left: 5px;
            cursor: pointer;

        }

        .modal-body label {
            display: block;
            margin-bottom: 10px;
        }

        .modal-content {
            height: 600px;
        }

        #filterValuesList {
            max-height: 100px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
        }

        .filter-item {
            margin-bottom: 5px;
            cursor: pointer;
        }

        .red-cell {
            background-color: #ffcccc;
        }

        .yellow-cell {
            background-color: #ecec58;
        }

        .light-yellow-cell {
            background-color: #ffffe0;
        }

        .green-cell {
            background-color: #ccffcc;
        }

        .headerContainer {
            display: flex;
            justify-content: space-around;
            width: 100%;
            /* max-height: 40px; */
            padding: 30px;
        }

        .input-group {
            width: 50%;
        }

        .reloadData {
            height: calc(1.5em + .75rem + 2px);
        }

        .deleteModify {
            height: calc(1.5em + .75rem + 2px);
        }

        .inscription {
            font-size: smaller;
            color: rgba(44, 76, 65, 0.54);
            font-style: italic;
        }

        .table-inner {
            position: relative;
            overflow: auto;
            max-height: 80%;
            max-width: 100%;
            padding: 0;
            margin-left: 30px;
            margin-right: 30px;
            margin-bottom: 30px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            padding: 8px 16px;
            border: 1px solid #ccc;
        }

        thead {
            position: sticky;
            top: 0;
            background: #f9f9f9;
            z-index: 10;
        }
        .fixed-column {
            position: sticky;
            left: 0;
            background-color: #fff;
          
            /* z-index: 2; */
        }

        .fixed-column-2 {
            position: sticky;
            left: 100px;
            background-color: #fff;
           
            /* z-index: 2; */
        }

        /* tbody td:first-child {
            z-index: 5;
        }
        tbody td:nth-child(2) {
            position: sticky;
            left: 75px;
            background: #f9f9f9;
            z-index: 5;
        } */

        @media (max-width: 1700px) {
        body {
            font-size: 0.8rem !important;
        }

        .headerContainer {
            padding: 20px;
        }

        
    }
    </style>
</head>

<body>


    <div class="table-wrapper">
        <div class="headerContainer">
            <div class="input-group">
                <input type="number" id="daysInput" class="form-control" placeholder="Введите количество дней"
                    aria-label="Введите количество дней от 15 до 45" aria-describedby="basic-addon2" min="15" max="45">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary calculateReplenishment" type="button">Рассчитать пополнение
                        (шт)</button>
                </div>
            </div>
            <button class="btn btn-outline-secondary deleteModify" type="button">Показать товар без модификаций</button>
            <button class="btn btn-outline-secondary reloadData" type="button">Обновить данные</button>
        </div>

        <div class="table-inner container mt-4">
            <table class="table table-bordered" id="data-table">
                <thead class="thead-dark">
                    <tr>
                        <th class="fixed-column">Фото</th>
                        <th class="fixed-column-2">Предмет <i class="bi bi-filter" data-column="subjectName"></i></th>
                        <th>Номенклатура (введите) <i class="bi bi-filter" data-column="nmID"></i></th>
                        <th>Размер (введите) <i class="bi bi-filter" data-column="allowed_sizes"></i></th>
                        <th>Заказы 1м <i class="bi bi-filter" data-column="orders30"></i></th>
                        <th>Заказы 14 д <i class="bi bi-filter" data-column="orders14"></i></th>
                        <th>График продаж </th>
                        <th>Остаток (шт) <i class="bi bi-filter" data-column="leftovers"></i></th>
                        <th>Остаток (дн) <i class="bi bi-filter" data-column="leftoversDays"></i></th>
                        <th>Пополнить (шт) <i class="bi bi-filter" data-column="replenishment"></i></th>
                        <th>Артикул <i class="bi bi-filter" data-column="vendorCode"></i></th>
                    </tr>
                </thead>

                <tbody>
                    <!-- Строки  добавлены через renderTable -->
                </tbody>
            </table>
            <div id="loading" style="display: none;">Загрузка...</div>
        </div>


        <div class="modal fade" id="filterModal" tabindex="-1" role="dialog" aria-labelledby="filterModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="filterModalLabel">Фильтрация</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <label>
                            <input type="radio" name="sortOrder" value="asc"> Сортировка от А до Я
                        </label>
                        <label>
                            <input type="radio" name="sortOrder" value="desc"> Сортировка от Я до А
                        </label>
                        <div id="filterValuesList"></div>
                        <button id="resetFilter" class="btn btn-secondary mt-2" disabled>Сброс фильтра</button>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="applyFilter">Применить</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>
    </div>





    <script>
        let currentColumn = '';
        const sessionData = sessionStorage.getItem('data');

        function fetchData() {
            
            $('#loading').show();
            $('tbody').hide();

// !!!! ПРИ ПОЛУЧЕНИИ ДАННЫХ ИЗ АПИ УБРАТЬ СТРОЧКИ НИЖЕ И РАССКОМЕНТИРОВАТЬ ПОЛУЧЕНИЕ ДАННЫХ ЧЕРЕЗ ajax!!!
            $.getJSON('data.json', function (response) {
                originalData = response.data;
                sessionStorage.setItem('data', JSON.stringify(originalData)); //добавим дату с хранилище
                $('tbody').show();
                renderTable(originalData)
                $('#loading').hide();
            }).fail(function () {
                console.error('Ошибка при загрузке данных');
                $('#loading').hide();
            });

            //!!!здесь конец строчек получения данных из файла, нужно расскоментировать код ниже:

            // $.ajax({
            // url: '/api/get_stat_table',
            // method: 'GET',
            // dataType: 'json',
            // success: function(response) {
            // originalData = response.data;
            // sessionStorage.setItem('data', JSON.stringify(originalData));
            // $('tbody').show();
            // renderTable(originalData);
            // $('#loading').hide();
            // },
            // error: function() {
            // console.error('Ошибка при получении данных');
            // $('#loading').hide();
            // }
            // });

            // !!! Конец получения даты из апи
        }

        
        function renderTable(data) {
            const tbody = $('#data-table tbody');
            tbody.empty();

            data.forEach(item => {
                const photo = item.photos ? `<img src="${item.photos[0].c246x328}" alt="Фото">` : '';
                const subject = item.subjectName || '';
                const nmID = item.nmID || '';
                const vendorCode = item.vendorCode || '';
                const graph = item.graph || '';

                item.allowed_sizes.forEach(size => {
                    const orders30 = parseFloat(item['30midle_sales'][size]) || 0;
                    const orders14 = parseFloat(item['14midle_sales'][size]) || 0;
                    const leftovers = parseFloat(item['stocks'][size]) || 0;
                    const leftoversDays = orders30 === 0 ? 0 : (leftovers / orders30).toFixed(2);

                    const graphCell = `
                <td>
                    <div class="chart-container">
                        <canvas id="${nmID}-${size}" style="display: block; box-sizing: border-box;"></canvas>
                    </div>
                </td>
            `;

                    const leftoversCellClass = getColorClass(leftovers);
                    const leftoversDaysCellClass = getColorClass(leftoversDays);

                    tbody.append(`
                <tr>
                    <td class="fixed-column">${photo}</td>
                    <td class="fixed-column-2">${subject}</td>
                    <td>${nmID}</td>
                    <td>${size}</td>
                    <td>${orders30}</td>
                    <td>${orders14}</td>
                    ${graphCell}
                    <td class="${leftoversCellClass}">${leftovers}</td>
                    <td class="${leftoversDaysCellClass}">${leftoversDays}</td>
                    <td> <div class='inscription'>Введите кол-во дней в форму выше и рассчитайте </div></td>
                    <td>${vendorCode}</td>
                </tr>
            `);

                    initializeChart(`${nmID}-${size}`, graph);
                });
            });
        }

        function renderTableWithoutSizes(data) {
           
            const tbody = $('#data-table tbody');
            tbody.empty();

            data.forEach(item => {
                const photo = item.photos ? `<img src="${item.photos[0].c246x328}" alt="Фото">` : '';
                const subject = item.subjectName || '';
                const nmID = item.nmID || '';
                const vendorCode = item.vendorCode || '';
                const graph = item.graph || '';
                const orders30 = item['30midle_sales']
                const orders14 = item['14midle_sales']
                const leftovers = item['stocks']
                // console.log('leftovers: ',leftovers);
                let totalOrders30 = 0;
                let totalOrders14 = 0;
                let totalLeftovers = 0;


                // Проверяем, что orders30/orders14/leftovers не пустые и является объектом и собираем данные ключей в них
                if (orders30 && typeof orders30 === 'object') {
                    for (const key in orders30) {
                        if (orders30.hasOwnProperty(key)) {
                            totalOrders30 += orders30[key];
                        }
                    }
                }

                if (orders14 && typeof orders14 === 'object') {
                    for (const key in orders14) {
                        if (orders14.hasOwnProperty(key)) {
                            totalOrders14 += orders14[key];
                        }
                    }
                }
                if (leftovers && typeof leftovers === 'object') {
                    for (const key in leftovers) {
                        if (leftovers.hasOwnProperty(key)) {
                            totalLeftovers += leftovers[key];
                        }
                    }
                }
                const averageOrders30 = Number((totalOrders30).toFixed(2))
                const averageOrders14 = Number(parseFloat(totalOrders14).toFixed(2))
                const averageLeftovers = Number(parseFloat(totalLeftovers).toFixed(2))
                // console.log('averageLeftovers: ', averageLeftovers);
                // console.log(typeof (averageOrders30), typeof (averageOrders14), typeof (averageLeftovers));

                const leftoversDays = averageOrders30 === 0 ? 0 : (averageLeftovers / averageOrders30).toFixed(
                    2);

                const graphCell = `
            <td>
                <div class="chart-container">
                    <canvas id="${nmID}" style="display: block; box-sizing: border-box;"></canvas>
                </div>
            </td>
        `;

                const leftoversCellClass = getColorClass(leftovers);
                const leftoversDaysCellClass = getColorClass(leftoversDays);

                tbody.append(`
            <tr>
                <td class="fixed-column">${photo}</td>
                <td class="fixed-column-2">${subject}</td>
                <td>${nmID}</td>
                <td>-</td>
                <td>${averageOrders30}</td>
                <td>${averageOrders14}</td>
                ${graphCell}
                <td class="${leftoversCellClass}">${averageLeftovers}</td>
                <td class="${leftoversDaysCellClass}">${leftoversDays}</td>
                <td> <div class='inscription'>Введите кол-во дней в форму выше и рассчитайте </div></td>
                <td>${vendorCode}</td>
            </tr>
        `);

                initializeChart(nmID, graph);
            });
            
            
        }

        function renderTableReplenishment(data, valueReplenishment) {
            const tbody = $('#data-table tbody');
            tbody.empty();

            data.forEach(item => {
                const photo = item.photos ? `<img src="${item.photos[0].c246x328}" alt="Фото">` : '';
                const subject = item.subjectName || '';
                const nmID = item.nmID || '';
                const vendorCode = item.vendorCode || '';
                const graph = item.graph || '';

                item.allowed_sizes.forEach(size => {
                    const orders30 = parseFloat(item['30midle_sales'][size]) || 0;
                    const orders14 = parseFloat(item['14midle_sales'][size]) || 0;
                    const leftovers = parseFloat(item['stocks'][size]) || 0;
                    const leftoversDays = orders30 === 0 ? 0 : (leftovers / orders30).toFixed(2);
                    const replenishment = orders30 === 0 ? 0 : ((orders30 * valueReplenishment) -
                        leftovers).toFixed(2);

                    const graphCell = `
                <td>
                    <div class="chart-container">
                        <canvas id="${nmID}-${size}" style="display: block; box-sizing: border-box;"></canvas>
                    </div>
                </td>
            `;
                    const leftoversCellClass = getColorClass(leftovers);
                    const leftoversDaysCellClass = getColorClass(leftoversDays);
                    tbody.append(`
                <tr>
                    <td>${photo}</td>
                    <td>${subject}</td>
                    <td>${nmID}</td>
                    <td>${size}</td>
                    <td>${orders30}</td>
                    <td>${orders14}</td>
                    ${graphCell}
                    <td class="${leftoversCellClass}">${leftovers}</td>
                    <td class="${leftoversDaysCellClass}">${leftoversDays}</td>
                    <td> ${replenishment}</td>
                    <td>${vendorCode}</td>
                </tr>
            `);

                    initializeChart(`${nmID}-${size}`, graph);
                });
            });
        }


// функция отрисовки таблицы с одним графиком на товар:
        //         function renderTable(data) {
        //     const tbody = $('#data-table tbody');
        //     tbody.empty();

        //     data.forEach(item => {
        //         const photo = item.photos ? `<img src="${item.photos[0].c246x328}" alt="Фото">` : '';
        //         const subject = item.subjectName || '';
        //         const nmID = item.nmID || '';
        //         const vendorCode = item.vendorCode || '';
        //         const graph = item.graph || '';
        //         const rowCount = item.allowed_sizes.length;

        //         console.log('graph: ', graph);
        //         console.log('nmID: ', nmID);

        //         let firstRow = true;

        //         item.allowed_sizes.forEach(size => {
        //             const orders30 = parseFloat(item['30midle_sales'][size]) || 0;
        //             const orders14 = parseFloat(item['14midle_sales'][size]) || 0;
        //             const leftovers = parseFloat(item['stocks'][size]) || 0;
        //             const leftoversDays = orders30 === 0 ? 0 : (leftovers / orders30).toFixed(2);

        //             const graphCell = firstRow ? `
        //                 <td rowspan="${rowCount}">
        //                     <div class="chart-container">
        //                         <canvas id="${nmID}" style="display: block; box-sizing: border-box;"></canvas>
        //                     </div>
        //                 </td>
        //             ` : '';

        //             tbody.append(`
        //                 <tr>
        //                     <td>${photo}</td>
        //                     <td>${subject}</td>
        //                     <td>${nmID}</td>
        //                     <td>${size}</td>
        //                     <td>${orders30}</td>
        //                     <td>${orders14}</td>
        //                     ${graphCell}
        //                     <td>${leftovers}</td>
        //                     <td>${leftoversDays}</td>
        //                     <td> <div class='inscription'>Введите кол-во дней в форму выше и рассчитайте </div></td>
        //                     <td>${vendorCode}</td>
        //                 </tr>
        //             `);

        //             if (firstRow) {
        //                 initializeChart(nmID, graph);
        //                 firstRow = false;
        //             }
        //         });
        //     });
        // }


        function getColorClass(value) {
            if (value >= 0 && value <= 1.99) {
                return 'red-cell';
            } else if (value >= 2 && value <= 5.99) {
                return 'yellow-cell';
            } else if (value >= 6 && value <= 10.99) {
                return 'light-yellow-cell';
            } else if (value >= 11) {
                return 'green-cell';
            } else {
                return '';
            }
        }

        function sortData(column, order) {
            const table = $('#data-table tbody');
            const rows = table.find('tr').get(); //получили все строки в массив
            // console.log('rows: ',rows); 

            rows.sort((a, b) => {
                let aValue = $(a).find('td').eq(getColumnIndex(column)).text();
                let bValue = $(b).find('td').eq(getColumnIndex(column))
                    .text(); //если сортировка по столбцу 'nmID', функция getColumnIndex('nmID') вернет 2. Затем sortData использует этот индекс, чтобы получить текстовое содержимое ячеек с индексом 2 из строк a и b.

                const isNumber = !isNaN(parseFloat(aValue)) && !isNaN(parseFloat(bValue));
                const isCyrillic = /^[а-яА-ЯёЁ]+$/.test(aValue) && /^[а-яА-ЯёЁ]+$/.test(bValue);

                if (isNumber) {
                    return order === 'asc' ? aValue - bValue : bValue -
                        aValue; //asc - флаг для восходящей сорировки, если нажат он, то выполни ее, если не он, то нисходящую
                } else if (isCyrillic) {
                    return order === 'asc' ? aValue.localeCompare(bValue, 'ru') : bValue.localeCompare(aValue,
                        'ru');
                } else {
                    return order === 'asc' ? aValue.localeCompare(bValue, 'en') : bValue.localeCompare(aValue,
                        'en');
                }
            });
            //перезаписываем строки внужном порядке
            $.each(rows, (index, row) => {
                table.append(row);
            });
        }

        function getColumnIndex(column) {
            switch (column) {
                case 'subjectName':
                    return 1;
                case 'nmID':
                    return 2;
                case 'allowed_sizes':
                    return 3;
                case 'orders30':
                    return 4;
                case 'orders14':
                    return 5;
                    case 'leftovers':
                    return 7;
                    case 'leftoversDays':
                    return 8;
                    case 'replenishment':
                    return 9;
                case 'vendorCode':
                    return 10;
                default:
                    return -1;
            }
        }

        function getUniqueColumnValues(column) {
            const uniqueValues = [];
            const columnIndex = getColumnIndex(column);

            $('#data-table tbody tr').each(function () {
                const value = $(this).find('td').eq(columnIndex).text().trim();
                if (value !== '' && !uniqueValues.includes(value)) {
                    uniqueValues.push(value);
                }
            });

            return uniqueValues;
        }

        function initializeChart(canvasId, graphData) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            const daysOfWeek = ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"]; // индексы этих дней: 0,1,2,3,4,5,6
            const currentDate = new Date();
            const currentDayIndex = currentDate.getDay(); // нашли индекс текущего дня

            // console.log('canvasId: ', canvasId, 'graphData: ', graphData);

            // меняем массив дней недели так, чтобы справа был текущий день недели
            const labels = [...daysOfWeek.slice(currentDayIndex + 1), ...daysOfWeek.slice(0, currentDayIndex + 1)];

            const currentWeekData = new Array(7).fill(0); // Продажи текущей недели
            const previousWeekData = new Array(7).fill(0); // Продажи предыдущей 

            // меняем строку даты в объект Date
            const parseDate = (dateString) => {
                const [day, month, year] = dateString.split('.').map(num => parseInt(num, 10));
                return new Date(
                    `20${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`);
            };

            // Функция для получения индекса дня недели
            const getWeekdayIndex = (date) => {
                return date.getDay();
            };

            // Заполняем данные продаж для текущей и предыдущей недели
            for (const [dateString, count] of Object.entries(graphData)) {
                const date = parseDate(dateString);
                const dayDiff = Math.floor((currentDate - date) / (1000 * 60 * 60 * 24));
                if (dayDiff >= 0 && dayDiff < 7) {
                    currentWeekData[(7 + getWeekdayIndex(date) - currentDayIndex - 1) % 7] = count;
                } else if (dayDiff >= 7 && dayDiff < 14) {
                    previousWeekData[(7 + getWeekdayIndex(date) - currentDayIndex - 1) % 7] = count;
                }
            }

            const myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Продажи предыдущей недели',
                        data: previousWeekData,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Продажи текущей недели',
                        data: currentWeekData,
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'grey' // Цвет текста на оси Y
                            }
                        },
                        x: {
                            ticks: {
                                color: 'grey' // Цвет текста на оси X
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: 'grey' // Цвет текста в легенде
                            }
                        },
                        tooltip: {
                            enabled: true,
                            callbacks: {
                                label: function (tooltipItem) {
                                    let label = tooltipItem.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += tooltipItem.raw.toFixed(2);
                                    return label;
                                }
                            }
                        }
                    },
                    maintainAspectRatio: false,
                    responsive: true
                }
            });
        }
       
        $(document).on('click', '.calculateReplenishment',function (value) {
        const valueReplenishment = parseInt($('#daysInput').val());

        if (isNaN(valueReplenishment) || valueReplenishment < 15 || valueReplenishment > 45) {
            alert('Введите число в диапазоне от 15 до 45');
        } else {
            renderTableReplenishment(originalData, valueReplenishment);
            $('#daysInput').val('');
            $('.deleteModify').text("Показать товар без модификаций");
        }
    });
        
    $(document).on('click', '.reloadData', function () {
            sessionStorage.clear();
            $('.deleteModify').text("Показать товар без модификаций");
            fetchData();
        });


        $(document).on('click', '.deleteModify', function () {
    if ($(this).text() === "Показать товар без модификаций") {   
        $(this).text("Показать модификации");   
        renderTableWithoutSizes(JSON.parse(sessionData));
       
    } else if ($(this).text() === "Показать модификации") {
        $(this).text("Показать товар без модификации");      
        renderTable(JSON.parse(sessionData));  
    }
});

$(document).ready(function () {
    let filterStatus = {}; // объект для отслеживания состояния фильтрации колонок
    let sortStatus = {}; // объект для отслеживания состояния сортировки колонок
    let currentColumn = null; // текущая колонка для фильтрации или сортировки
    let originalOrder = []; // массив для хранения исходного порядка строк

    if (sessionData) {
        originalData = JSON.parse(sessionData);
        renderTable(originalData);
        saveOriginalOrder();
    } else {
        fetchData();
    }

    function saveOriginalOrder() {
        originalOrder = $('#data-table tbody tr').get();
    }

    $('.bi-filter').on('click', function () {
        currentColumn = $(this).data('column');
        const uniqueValues = getUniqueColumnValues(currentColumn);
        // console.log('currentColumn: ', currentColumn);

        // Очищаем предыдущий список и добавляем новые элементы
        $('#filterValuesList').empty();
        uniqueValues.forEach(value => {
            $('#filterValuesList').append(
                `<div class="filter-item">${value}</div>`
            );
        });

        $('#filterModal').modal('show');
    });

    $('#applyFilter').on('click', function () {
        const sortOrder = $('input[name="sortOrder"]:checked').val();
        if (sortOrder) {
            // Сбрасываем состояние сортировки для всех колонок перед применением новой сортировки
            for (let column in sortStatus) {
                delete sortStatus[column];
            }

            sortData(currentColumn, sortOrder);
            $('#resetFilter').prop('disabled', false);
            $('#filterModal').modal('hide');

            // Устанавливаем зеленый цвет только для иконки в текущей колонке для сортировки
            sortStatus[currentColumn] = true;
            updateFilterIcons();
        }
    });

    $('#resetFilter').on('click', function () {
        if (filterStatus[currentColumn]) {
            // Показать все строки, скрытые при фильтрации
            $('#data-table tbody tr').show();
        } else if (sortStatus[currentColumn]) {
            // Восстановить исходный порядок строк
            $.each(originalOrder, (index, row) => {
                $('#data-table tbody').append(row);
            });
        }

        $('input[name="sortOrder"]').prop('checked', false);
        $('#filterModal').modal('hide');

        // Удаляем состояние фильтрации и сортировки для текущей колонки
        delete filterStatus[currentColumn];
        delete sortStatus[currentColumn];
        updateFilterIcons();
    });

    $(document).on('click', '.filter-item', function () {
        const filterValue = $(this).text().trim();
        $('#data-table tbody tr').each(function () {
            const rowValue = $(this).find('td').eq(getColumnIndex(currentColumn)).text().trim();
            if (rowValue === filterValue) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });

        $('#filterModal').modal('hide');

        // Сбрасываем состояние сортировки для всех колонок при применении фильтра
        for (let column in sortStatus) {
            delete sortStatus[column];
        }
        // Устанавливаем зеленый цвет только для иконки в текущей колонке для фильтрации
        filterStatus[currentColumn] = true;
        updateFilterIcons();
    });

    

    function updateFilterIcons() {
        $('.bi-filter').each(function () {
            const column = $(this).data('column');
            if (filterStatus[column]) {
                $(this).css('color', 'green');
            } else if (sortStatus[column]) {
                $(this).css('color', 'green');
            } else {
                $(this).css('color', 'white');
            }
        });
    }
    
});

    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>